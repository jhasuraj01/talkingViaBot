<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Forward to friends</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <main>
        <label for="username-in">
            Write your name:
            <input type="text" name="username-in" id="username-in" placeholder="Buddy 1">
        </label>
        <label for="friendname-in">
            Write your friends nick name:
            <input type="text" name="friendname-in" id="friendname-in" placeholder="Buddy 2">
        </label>
        <button id="viewDemo_btn">View Demo</button>
        <button id="copyURL-btn">COPY URL</button>
        <p id="url-copy-alert" style="text-align: center;">&nbsp;</p>
    </main>
    <label for="url-in">
        <input type="text" name="url-in" id="url-in" style="position: absolute; top: 0; left: 0; display: none;">
    </label>
    <footer class="body-footer">
        <p>Suraj Jha &copy; 2019 - &infin;, All rights reserved.</p>
        <p>leave a <a
                href="https://docs.google.com/forms/d/e/1FAIpQLSf7-PKL6oXsjMdDqzk_TyY9UftKPqadK_vdEW3Uy3go32VZrw/viewform?usp=sf_link" target="_blank" rel="noopener noreferrer">feedback</a></p>
        <p>Message me on <a href="https://www.instagram.com/jhasuraj_/" target="_blank" rel="noopener noreferrer">INSTAGRAM</a></p>
    </footer>
    <script src="../encrypt.js"></script>
    <script>
        let url_in = document.getElementById('url-in');
        let friendname_in = document.getElementById('friendname-in');
        let username_in = document.getElementById('username-in');
        let url_copy_alert = document.getElementById('url-copy-alert');
        let url = new URL(`https://the-suraj.github.io/talkingViaBot/`);

        let create_url = () => {
            /* encrypt Your Name */
            let username_encryption_key = username_in.value.length % 26 > 3 ? username_in.value.length : 10;
            let encrypted_username = encrypt(username_in.value, username_encryption_key);

            /* encrypt friends name */
            let friendname_encryption_key = friendname_in.value.length % 26 > 3 ? friendname_in.value.length : 10;
            let encrypted_friendname = encrypt(friendname_in.value, friendname_encryption_key);

            // set parameters
            url.search = `fn=${encrypted_username}&un=${encrypted_friendname}`;
            return null;
        }
        let copyURLFn = () => {
            create_url();
            url_in.value = url.href;
            url_in.style.display = "block";
            url_in.select();
            document.execCommand('copy');
            url_in.style.display = "none";
            url_copy_alert.innerText = "Url Copied";
            return null;
        }
        document.getElementById("copyURL-btn").addEventListener("click", copyURLFn);

        let remove_text_url_copy_alert = () => {
            url_copy_alert.innerText = "";
        }
        document.getElementById('username-in').addEventListener('input', remove_text_url_copy_alert);
        document.getElementById('friendname-in').addEventListener('input', remove_text_url_copy_alert);

        let popitup = () => {
            create_url();
            let windowName = "chat Box";
            newwindow = window.open(url, windowName, `height=500,width=300`);
            if (window.focus) { newwindow.focus() };
            return false;
        }
        document.getElementById('viewDemo_btn').addEventListener('click', popitup);
    </script>
</body>

</html>