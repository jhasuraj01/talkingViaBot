<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Forward to friends</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <main>
        <label for="username-in">
            Write your name:
            <input type="text" name="username-in" id="username-in" placeholder="Write your name">
        </label>
        <label for="friendname-in">
            Write your friends nick name:
            <input type="text" name="friendname-in" id="friendname-in" placeholder="Write nick name of your friend">
        </label>
        <label  id="chat-cat-lbl">
            Select chat Catagory:
        </label>
        <!-- <a href="#" target="_blank" rel="noopener noreferrer" id="viewDemo_btn">View Demo</a> -->
        <button id="viewDemo_btn">View Demo</button>
        <button id="copyURL-btn">COPY URL</button>
        <p id="url-copy-alert" style="text-align: center;"></p>
    </main>
    <label for="url-in">
        <input type="text" name="url-in" id="url-in" style="position: absolute; top: 0; left: 0; display: none;">
    </label>

    <script src="./chat-cat.js"></script>
    <script src="../encrypt.js"></script>
    <script>
        let url_in = document.getElementById('url-in');
        let friendname_in = document.getElementById('friendname-in');
        let username_in = document.getElementById('username-in');
        let url_copy_alert = document.getElementById('url-copy-alert');
        let url = new URL(`https://the-suraj.github.io/talkingViaBot/`);

        let create_url = () => {
            /* encrypt Your Name */
            let username_encryption_key = username_in.value.length % 26 > 3 ? username_in.value.length : 10;
            let encrypted_username = encrypt(username_in.value, username_encryption_key);

            /* encrypt friends name */
            let friendname_encryption_key = friendname_in.value.length % 26 > 3 ? friendname_in.value.length : 10;
            let encrypted_friendname = encrypt(friendname_in.value, friendname_encryption_key);

            /* get and encrypt  chat_cat_url_encoding*/
            let chat_cat_url_encoding = create_chat_cat_url_encoding_fn();
            let chat_cat_url_encoding_encryption_key = chat_cat_url_encoding.length % 26 > 3 ? chat_cat_url_encoding.length : 10;
            let encrypted_chat_cat_url_encoding =  encrypt(chat_cat_url_encoding, chat_cat_url_encoding_encryption_key);

            // set parameters
            url.search = `fn=${encrypted_username}&un=${encrypted_friendname}&ct=${encrypted_chat_cat_url_encoding}`;
            return null;
        }
        let copyURLFn = () => {
            create_url();
            url_in.value = url.href;
            url_in.style.display = "block";
            url_in.select();
            document.execCommand('copy');
            url_in.style.display = "none";
            url_copy_alert.innerText = "Url Copied";
            return null;
        }
        document.getElementById("copyURL-btn").addEventListener("click", copyURLFn);

        let remove_text_url_copy_alert = () => {
            url_copy_alert.innerText = " ";
        }
        document.getElementById('username-in').addEventListener('input', remove_text_url_copy_alert);
        document.getElementById('friendname-in').addEventListener('input', remove_text_url_copy_alert);

        let popitup = () => {
            create_url();
            let windowName = "chat Box"
            newwindow = window.open(url, windowName, `height=500,width=300`);
            if (window.focus) { newwindow.focus() }
            return false;
        }
        document.getElementById('viewDemo_btn').addEventListener('click', popitup);
    </script>
</body>

</html>