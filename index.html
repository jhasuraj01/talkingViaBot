<!DOCTYPE html>
<html>

<head>
   <meta charset="utf-8" />
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <title>Chat Bot</title>
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <link rel="stylesheet" href="./main.mini.css" />
</head>

<body>
   <div class="background"></div>
   <div class="chat-header">
      <div class="user-profile"></div>
      <div class="user-name" id="user-name">Friend</div>
      <div class="state">online</div>
      <button class="menu-dots">&#x22EE;</button>
      <div class="menu">
         <p>View contact</p>
         <p>Media</p>
         <p>Search</p>
         <p>Mute Notification</p>
         <p>Wallpaper</p>
         <p>
            <span class="more">More</span>
            <span class="more-symbol">&#x25BA;</span>
         </p>
      </div>
   </div>
   <div class="chat-body">
      <div id="chat-bottom" style="clear: both;"></div>
   </div>
   <label for="userInput" id="input-container">
      <input id="userInput" placeholder="Type a message" />
         <button id="putUserInput">
            <svg fill="white">
               <polyline points="0,0 2,11 18,13 2,15 0,26 26,13" />
            </svg>
         </button>
   </label>
   <script src="./encrypt.js"></script>
   <script>
      let username = null;
      let friendname = null;
      // getting name via url i.e www.example.com?name=friend
      // task to get 'friend' as name from title
      // Using URL Class to find the value of the property in url.
      let params = (new URL(location.href)).searchParams;

      // user
      if (params.get('un')) {
         encrypted_username = params.get('un');
         let username_encryption_key = encrypted_username.length % 26 > 3 ? encrypted_username.length : 10;
         username = decrypt(encrypted_username, username_encryption_key);

      } else {
         username = "buddy";
      }

      // sender
      if (params.get('fn')) {
         encrypted_friendname = params.get('fn');
         let friendname_encryption_key = encrypted_friendname.length % 26 > 3 ? encrypted_friendname.length : 10;
         friendname = document.getElementById('user-name').innerText = decrypt(encrypted_friendname, friendname_encryption_key);
         // console.log(document.getElementById("user-name"));
      }

      currentState("typing...");
      setTimeout(() => {
         Write("Aur " + username + " kaisa hai!ðŸ˜");
      }, 2000);
      setTimeout(() => {
         Write("Aaj tera kaatne ka bohot man kar raha hai....!ðŸ˜†");
      }, 4000);
      setTimeout(() => {
         Write("Ek help Chahiye Kya.....?ðŸ˜ŽðŸ˜Ž");
         currentState("online");
      }, 7000);

      function currentState(str) {
         document.querySelector(".state").innerText = str;
      }

      let numberOfInput = 0;

      function put_user_Input() {
         let input_field = document.getElementById('userInput');
         let chatBottom = document.getElementById("chat-bottom");
         chatBottom.insertAdjacentHTML('beforebegin', `<p class="my-message message">${input_field.value}<span class="message-time">${Time()}</span></p>`);
         chatBottom.scrollIntoView();
         input_field.value = "";

         numberOfInput++;

         if (numberOfInput === 1) {
            setTimeout(() => {
               currentState("typing...");
            }, 1000);
            setTimeout(() => {
               Write("bsdk lele help lawde..!");
            }, 3000);
            setTimeout(() => {
               Write(
                  "maine kal jonny uncle ko bohot request kiya, ki kaise bhi " + username + " ko star bana do.... mera dost hai voðŸ¤©ðŸ¤©"
               );
            }, 8000);
            setTimeout(() => {
               Write("usne tera address manga mere se!ðŸ˜‰");
            }, 16000);
            setTimeout(() => {
               Write("Aaj John Bhai tere ghar pe aane wala hai....!ðŸ˜œðŸ˜œðŸ˜œ");
               currentState("online");
            }, 20000);
         } else if (numberOfInput === 2) {
            setTimeout(() => {
               currentState("typing...");
            }, 1000);
            setTimeout(() => {
               Write(
                  "Abe lawde xvideos pe terko trend karwaa dega, chutiye!"
               );
            }, 3000);
            setTimeout(() => {
               Write(
                  "tere ghar pe tujhe personally momentum conservation padhaega...ðŸ˜€ðŸ˜€ðŸ˜€"
               );
            }, 7000);
            setTimeout(() => {
               Write("ðŸ¤£ðŸ¤£ðŸ¤£ðŸ¤£ðŸ¤£");
               currentState("online");
            }, 9000);
         } else if (numberOfInput === 3) {
            setTimeout(() => {
               currentState("typing...");
            }, 1000);
            setTimeout(() => {
               Write("Chal bye mujhe kaam haiðŸ˜");
            }, 3000);
            setTimeout(() => {
               Write("Tu enjoy kar aaj... vo Aa jaaegaðŸ˜ðŸ˜");
            }, 7000);
            setTimeout(() => {
               Write("ðŸ‘‹ðŸ‘‹");
               currentState("online");
            }, 9000);
            setTimeout(() => {
               currentState("last seen today at " + Time());
            }, 12000);
         } else if (numberOfInput === 4) {
            setTimeout(() => {
               currentState("online");
            }, 1000);
            setTimeout(() => {
               currentState("typing...");
            }, 3000);
            setTimeout(() => {
               Write(
                  "abe Chutiye mai " + friendname + " nhi hu, jo to itna excited ho raha hai, I am a simple robot created by him...!"
               );
            }, 6000);
            setTimeout(() => {
               Write("ðŸ˜ðŸ˜ðŸ˜ðŸ˜ðŸ˜ðŸ˜ðŸ˜");
            }, 10000);
            setTimeout(() => {
               Write("Chal wattðŸ‘ŠðŸ‘Š");
               currentState("online");
            }, 12000);
            setTimeout(() => {
               currentState("last seen today at " + Time());
            }, 14000);
         }
      }

      
      document.getElementById('putUserInput').addEventListener('click', put_user_Input);
      document.getElementById('putUserInput').addEventListener('click', () => {document.getElementById('userInput').focus()});
      
      function Time() {
         let date = new Date();
         let time;
         if (date.getHours() > 12) {
            time = `${("00" + (date.getHours() - 12)).substr(-2)}:${(
               "00" + date.getMinutes()
            ).substr(-2)} pm`;
            return time;
         }
         time = `${("00" + date.getHours()).substr(-2)}:${(
            "00" + date.getMinutes()
         ).substr(-2)} am`;
         return time;
      }
      function Write(message) {
         let chatBottom = document.getElementById("chat-bottom");
         chatBottom.insertAdjacentHTML('beforebegin', `<p class="friends-message message">${message}<span class="message-time">${Time()}</span></p>`);
         chatBottom.scrollIntoView();
         document.getElementById('userInput').focus();
      }
   </script>
</body>

</html>